<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="æ¥è®¡ç®—ä½ åå­—çš„GayæŒ‡æ•°æŠŠ~~~ğŸ˜ğŸ‘¨â€â¤ï¸â€ğŸ‘¨">
    <meta name="keywords" content="LTSXx,game,gay,ç”·åŒ,è®¡ç®—,ğŸ”®,å‡Œé“œx,aoeb101la,lingtong,è¯¸è‘›ç§‹äº‘">
    <title>åå­—GayæŒ‡æ•°è®¡ç®—å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/pinyin@4.0.0/lib/umd/pinyin.js"></script>
    <script src="https://unpkg.com/wanakana@5.3.1/wanakana.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .rainbow-text {
            background: linear-gradient(90deg, #ef4444, #f97316, #eab308, #84cc16, #22c55e, #14b8a6, #06b6d4, #3b82f6, #8b5cf6, #d946ef);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        .progress-bar-inner {
            transition: width 0.8s cubic-bezier(0.25, 0.1, 0.25, 1), background-color 0.8s ease;
        }
        /* -- æ–°å¢å’Œä¿®æ”¹çš„åŠ¨ç”» -- */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-6px); }
            20%, 40%, 60%, 80% { transform: translateX(6px); }
        }
        .shake { animation: shake 0.5s ease-in-out; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }

        @keyframes rainbow-glow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .rainbow-100 {
            background: linear-gradient(270deg, #d946ef, #8b5cf6, #3b82f6, #06b6d4, #14b8a6, #22c55e, #84cc16, #eab308, #f97316, #ef4444);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbow-glow 2s linear infinite;
        }

        @keyframes initial-fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .container-fade-in { animation: initial-fade-in 0.7s cubic-bezier(0.25, 0.1, 0.25, 1) forwards; }

        /* ç»“æœç™¾åˆ†æ¯”çš„å¼¹å‡ºåŠ¨ç”» */
        @keyframes pop-in {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        .pop-in { animation: pop-in 0.5s cubic-bezier(0.25, 0.1, 0.25, 1) forwards; }
        
        /* è¿›åº¦æ¡çš„è¾‰å…‰åŠ¨ç”» */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 8px rgba(168, 85, 247, 0.3), 0 0 12px rgba(168, 85, 247, 0.2); }
            50% { box-shadow: 0 0 16px rgba(168, 85, 247, 0.7), 0 0 24px rgba(168, 85, 247, 0.5); }
        }
        .pulsing-glow { animation: pulse-glow 1.5s infinite ease-in-out; }

    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <!-- æ–°å¢çš„é¡¶éƒ¨å¯¼èˆªå®¹å™¨ -->
    <div class="fixed top-0 left-0 right-0 p-4 flex justify-between items-center z-10">
        <!-- å†å²è®°å½•æŠ˜å æ å®¹å™¨ -->
        <div class="relative">
            <button id="historyToggleBtn" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 transform hover:scale-105 active:scale-95 shadow-lg">
                å†å²è®°å½•
            </button>
            <div id="historyPanel" class="hidden mt-2 w-64 bg-gray-800 rounded-lg shadow-xl p-4 space-y-2 max-h-64 overflow-y-auto absolute left-0">
                <h3 class="text-lg font-semibold text-gray-300 mb-3">å†å²è®°å½•</h3>
                <ul id="historyList" class="space-y-2 text-sm text-gray-400">
                    <!-- History items will be inserted here by JS -->
                </ul>
                <button id="clearHistoryBtn" class="w-full mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95 shadow-lg text-sm">
                    æ¸…é™¤å†å²è®°å½•
                </button>
                <p class="text-xs text-gray-500 mt-4">æˆ‘ä»¬ä¸ä½¿ç”¨æ‚¨è¾“å…¥çš„ä¿¡æ¯ï¼Œç»“æœä»…ä¾›å¨±ä¹ã€‚</p>
            </div>
        </div>

        <!-- åˆ†äº«æŒ‰é’®å®¹å™¨ -->
        <div class="relative">
            <button id="shareButton" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 transform hover:scale-105 active:scale-95 shadow-lg hidden">
                åˆ†äº«
            </button>
        </div>
    </div>

    <!-- å¢åŠ äº† container-fade-in class æ¥å®ç°è¿›å…¥åŠ¨ç”» -->
    <div class="w-full max-w-md mx-auto bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 space-y-6 container-fade-in">
        <!-- Header -->
        <div class="text-center">
            <h1 class="text-3xl font-bold rainbow-text">åå­—GayæŒ‡æ•°è®¡ç®—å™¨</h1>
            <p class="text-gray-400 mt-2">è¾“å…¥ä¸€ä¸ªåå­—ï¼Œçœ‹çœ‹â€œç§‘å­¦â€çš„è®¡ç®—ç»“æœï¼</p>
            <p class="text-xs text-gray-500 mt-1">ï¼ˆçº¯å±å¨±ä¹ï¼Œè¯·å‹¿å½“çœŸï¼‰</p>
        </div>

        <!-- Input Form -->
        <div class="space-y-4">
            <input type="text" id="nameInput" placeholder="è¾“å…¥ä»»ä½•åå­—æˆ–ç½‘å" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
            <!-- å¢åŠ äº† active:scale-95 æ¥å®ç°æŒ‰é’®æŒ‰å‹æ•ˆæœ -->
            <button id="calculateBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95 shadow-lg">
                <span id="btnText">å¼€å§‹è®¡ç®—</span>
                <span id="btnSpinner" class="hidden animate-spin">â—</span>
            </button>
        </div>

        <!-- Result Section -->
        <div id="resultSection" class="hidden pt-6 space-y-4 text-center">
            <h2 class="text-xl font-semibold text-gray-300 fade-in-up">è®¡ç®—ç»“æœ for "<span id="resultName" class="font-bold text-purple-400"></span>"</h2>
            
            <div class="relative w-full h-8 bg-gray-700 rounded-full overflow-hidden border-2 border-gray-600">
                <div id="progressBar" class="progress-bar-inner h-full rounded-full" style="width: 0%;"></div>
                <span id="percentageText" class="absolute inset-0 flex items-center justify-center text-sm font-bold text-white opacity-0">0%</span>
            </div>

            <p id="resultMessage" class="text-lg font-medium text-gray-200 h-12 flex items-center justify-center"></p>
        </div>
    </div>

    <div class="fixed bottom-4 right-4 text-xs text-gray-600">
        <a href="https://github.com/Akanyi/Gaynum" target="_blank" rel="noopener noreferrer" class="hover:text-gray-500 transition-colors duration-300">
            GitHub: Akanyi/Gaynum
        </a>
    </div>

    <script>
        window.onload = function() {
            const nameInput = document.getElementById('nameInput');
            const calculateBtn = document.getElementById('calculateBtn');
            const btnText = document.getElementById('btnText');
            const btnSpinner = document.getElementById('btnSpinner');
            
            const resultSection = document.getElementById('resultSection');
            const resultName = document.getElementById('resultName');
            const progressBar = document.getElementById('progressBar');
            const percentageText = document.getElementById('percentageText');
            const resultMessage = document.getElementById('resultMessage');
            const shareButton = document.getElementById('shareButton'); // æ–°å¢
            const historyToggleBtn = document.getElementById('historyToggleBtn'); // æ–°å¢
            const historyPanel = document.getElementById('historyPanel'); // æ–°å¢
            const historyList = document.getElementById('historyList'); // æ–°å¢
            const clearHistoryBtn = document.getElementById('clearHistoryBtn'); // æ–°å¢

            let typingInterval; // ç”¨äºæ§åˆ¶æ‰“å­—æœºæ•ˆæœçš„è®¡æ—¶å™¨

            // Base64 ç¼–ç å’Œè§£ç å‡½æ•°
            // ç®€å•çš„å“ˆå¸Œå‡½æ•°ï¼Œç”¨äºæ ¹æ®è¾“å…¥ç”Ÿæˆç¡®å®šæ€§ç»“æœæ¶ˆæ¯
            function simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash |= 0; // Convert to 32bit integer
                }
                return Math.abs(hash);
            }

            // Base64 ç¼–ç å’Œè§£ç å‡½æ•°
            function encodeBase64(str) {
                return btoa(encodeURIComponent(str));
            }

            function decodeBase64(str) {
                try {
                    return decodeURIComponent(atob(str));
                } catch (e) {
                    console.error("Base64 decoding failed:", e);
                    return null;
                }
            }

            // ä¿å­˜å†å²è®°å½•
            function saveHistory(name, percentage, message) {
                let history = JSON.parse(localStorage.getItem('gayIndexHistory') || '[]');
                history.unshift({ name, percentage, message, timestamp: new Date().toLocaleString() }); // æ·»åŠ åˆ°æ•°ç»„å¼€å¤´
                if (history.length > 10) { // åªä¿ç•™æœ€æ–°çš„10æ¡è®°å½•
                    history = history.slice(0, 10);
                }
                localStorage.setItem('gayIndexHistory', JSON.stringify(history));
                renderHistory(); // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
            }

            // æ¸²æŸ“å†å²è®°å½•
            function renderHistory() {
                const history = JSON.parse(localStorage.getItem('gayIndexHistory') || '[]');
                historyList.innerHTML = ''; // æ¸…ç©ºç°æœ‰åˆ—è¡¨
                if (history.length === 0) {
                    historyList.innerHTML = '<li class="text-gray-500">æš‚æ— å†å²è®°å½•</li>';
                    return;
                }
                history.forEach((item, index) => {
                    const listItem = document.createElement('li');
                    listItem.className = 'p-2 bg-gray-700 rounded-md flex justify-between items-center cursor-pointer hover:bg-gray-600 transition duration-200';
                    listItem.innerHTML = `
                        <div class="flex-grow min-w-0">
                            <span class="font-semibold text-purple-300">${item.name}</span>: 
                            <span class="font-bold text-white">${item.percentage}%</span>
                            <p class="text-xs text-gray-400 mt-1 truncate">${item.message}</p>
                        </div>
                        <button class="recall-history text-purple-400 hover:text-purple-300 text-sm flex-shrink-0 whitespace-nowrap ml-2 px-3 py-1 rounded-md border border-purple-400 hover:bg-purple-700 transition duration-200" data-index="${index}">æŸ¥çœ‹</button>
                    `;
                    historyList.appendChild(listItem);
                });
            }

            // ä»å†å²è®°å½•ä¸­åŠ è½½å¹¶æ˜¾ç¤ºç»“æœ
            function recallHistoryItem(index) {
                const history = JSON.parse(localStorage.getItem('gayIndexHistory') || '[]');
                if (history[index]) {
                    const item = history[index];
                    nameInput.value = item.name; // å¡«å……è¾“å…¥æ¡†
                    displayResult(item.name, item.percentage, item.message); // ç›´æ¥æ˜¾ç¤ºç»“æœ
                    historyPanel.classList.add('hidden'); // æŠ˜å å†å²è®°å½•é¢æ¿
                }
            }

            function normalizeName(name) {
                let processedName = name.trim().toLowerCase();
                
                if (/[\u4e00-\u9fa5]/.test(processedName)) {
                    processedName = pinyin.pinyin(processedName, { style: pinyin.STYLE_NORMAL }).flat().join('');
                }
                if (wanakana.isJapanese(processedName)) {
                    processedName = wanakana.toRomaji(processedName);
                }
                
                const letters = processedName.replace(/[^a-z]/g, '');
                const numbers = processedName.replace(/[^0-9]/g, '');
                const specials = processedName.replace(/[a-z0-9]/g, '');

                return { letters, numbers, specials };
            }

            function getNumericValues(normalizedParts) {
                const letterValues = normalizedParts.letters.split('').map(char => char.charCodeAt(0) - 96);
                const numberSum = normalizedParts.numbers.split('').reduce((acc, digit) => acc + parseInt(digit, 10), 0);
                const specialSum = normalizedParts.specials.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                return { letterValues, numberSum, specialSum };
            }

            function matrixCalculation(values, originalName) {
                const { letterValues, numberSum, specialSum } = values;
                if (letterValues.length === 0 && numberSum === 0 && specialSum === 0) return 0;

                const letterSum = letterValues.reduce((acc, val) => acc + val, 0);
                const totalSum = letterSum + numberSum + specialSum;
                const magicConstant = originalName.length * 7;
                let hash = (letterValues.length > 0) ? (letterValues[0] * (letterValues[letterValues.length - 1] || 1)) : (numberSum * 13);
                hash += specialSum * 17;
                
                let result = (totalSum * magicConstant + hash) % 101;
                return result < 0 ? result + 101 : result;
            }

            function getResultMessage(percentage, name) { // å¢åŠ  name å‚æ•°
                const messageTiers = {
                    0: [ 
                        "0%... ä½ æ˜¯ç›´å°ºæˆç²¾äº†å—ï¼Ÿ", 
                        "é›¶ï¼ä½ çš„ä¸–ç•Œé‡Œè¿å½©è™¹éƒ½æ˜¯é»‘ç™½çš„å—ï¼Ÿ", 
                        "æˆåˆ†è¿‡çº¯ï¼Œå»ºè®®å»é’¢é“å‚ä¸Šç­ã€‚", 
                        "æ¯”æˆ‘çš„é“¶è¡Œä½™é¢è¿˜ç›´ï¼Œä»¤äººæ•¬ç•ã€‚", 
                        "æ£€æµ‹ä¸åˆ°ä»»ä½•å¼¯çš„è¿¹è±¡ï¼Œç¨‹åºå¯èƒ½å‡ºé”™äº†ã€‚",
                        "ä½ ç›´å¾—åƒä¸€é“æ•°å­¦é¢˜çš„è¾…åŠ©çº¿ï¼Œç®€å•æ˜äº†ã€‚",
                        "èšŠå­è§äº†ä½ éƒ½å¾—ç»•é“é£ï¼Œç”Ÿæ€•è¢«ä½ æ°ç›´äº†ã€‚",
                        "ä½ çš„ç”Ÿæ´»é‡Œæ˜¯ä¸æ˜¯åªæœ‰â€˜å¼‚æ€§ç›¸å¸â€™è¿™æ¡ç‰©ç†å®šå¾‹ï¼Ÿ",
                        "ä½ å°±æ˜¯ä¼ è¯´ä¸­çš„â€˜å–å‘â€™åæ ‡è½´åŸç‚¹æœ¬äººã€‚",
                        "ä½ å¯¹â€˜æŸœå­â€™çš„å”¯ä¸€è®¤çŸ¥ï¼Œå¯èƒ½å°±æ˜¯è£…è¡£æœçš„é‚£ä¸ªã€‚"
                    ],
                    10: [ 
                        "é’¢é“ç›´ç”·/å¥³ï¼Œå®‡å®™éƒ½æ°ä¸å¼¯ä½ ã€‚", 
                        "ä½ èµ°è¿‡çš„è·¯ï¼Œæ¯”ç¬”è¿˜ç›´ã€‚", 
                        "èº«ä¸Šå……æ»¡äº†â€˜ç›´â€™æ°”ï¼Œå¦–é­”é¬¼æ€ªéƒ½å¾—é€€æ•£ã€‚", 
                        "åˆ«è¯´å¼¯äº†ï¼Œä½ è¿è½¬ä¸ªå¼¯éƒ½è´¹åŠ²ã€‚", 
                        "å ªç§°å¼‚æ€§æ‹çš„æœ€åä¸€é“é˜²çº¿ã€‚",
                        "ä½ å¤§è„‘é‡Œçš„â€˜å¼¯â€™è·¯ï¼Œå¯¼èˆªéƒ½æœä¸åˆ°ã€‚",
                        "å¦‚æœå–å‘èƒ½å‘ç”µï¼Œä½ å°±æ˜¯ä¸ªæ°¸åŠ¨æœºã€‚",
                        "ä½ å¤§æ¦‚å°±æ˜¯é‚£ç§ä¼šé—®â€œä¸ºä»€ä¹ˆåŒæ€§æ‹è¦å«åŒå¿—â€çš„äººã€‚",
                        "ä½ å¯¹æ€§åˆ«çš„è®¤çŸ¥ï¼Œå°±åƒè€å¼ç”µè§†æœºä¸€æ ·åªæœ‰ä¸¤ä¸ªé¢‘é“ã€‚",
                        "ä½ æ€•ä¸æ˜¯ç›´ç”·/å¥³åŸ¹è®­ç­é‡Œçš„è¯¾ä»£è¡¨ï¼Ÿ"
                    ],
                    20: [ 
                        "ç›´å¾—æœ‰ç‚¹åˆ»æ„äº†ï¼Œæ˜¯ä¸æ˜¯åœ¨ä¼ªè£…ï¼Ÿ", 
                        "æŒ‡æ•°è¿™ä¹ˆä½ï¼Œæ˜¯ä¸æ˜¯å¯¹åŒæ€§æœ‰ä»€ä¹ˆè¯¯è§£ï¼Ÿ", 
                        "ä½ å¤§æ¦‚æ˜¯é‚£ç§â€˜å•Šï¼Ÿä»–ä¿©æ˜¯gayï¼Ÿâ€™çš„è¿Ÿé’ç±»å‹ã€‚", 
                        "ä½ çš„ä¸–ç•Œç®€å•å¾—åƒä¸€æ¡ç›´çº¿ã€‚", 
                        "æœ‹å‹ï¼ŒæåŒå³æ·±æŸœï¼Œå†æµ‹æµ‹ï¼Ÿ",
                        "ä½ çš„é›·è¾¾å¯èƒ½éœ€è¦ä¸€æ¬¡å›ºä»¶å‡çº§äº†ã€‚",
                        "ä½ çœ¼é‡Œçš„åŒæ€§å¥½å‹ï¼Œå¯èƒ½åªæ˜¯å•çº¯çš„â€˜å¥½å“¥ä»¬/å¥½å§å¦¹â€™ã€‚",
                        "ä½ å¯¹åŒæ€§çš„æ¬£èµï¼Œæ­¢æ­¥äºâ€˜è¿™äººç©¿æ­è¿˜ä¸é”™â€™ã€‚",
                        "ä½ çš„å†…å¿ƒæ¯«æ— æ³¢æ¾œï¼Œç”šè‡³è¿˜æƒ³åƒä¸€ç¢—æ³¡é¢ã€‚",
                        "ä½ ç¦»çœŸç›¸ï¼Œå°±å·®ä¸€å‰¯8å€é•œçš„è·ç¦»ã€‚"
                    ],
                    40: [ 
                        "å†…å¿ƒå¯èƒ½æœ‰ç‚¹å°æ³¢åŠ¨ï¼Œä½†æ— ä¼¤å¤§é›…ã€‚", 
                        "å¶å°”ä¼šè§‰å¾—â€˜åŒæ€§ä¹ŸæŒºå¯çˆ±çš„å˜›â€™çš„ç¨‹åº¦ã€‚", 
                        "é›·è¾¾å¶å°”ä¼šæ”¶åˆ°å¾®å¼±ä¿¡å·ï¼Œä½†å¾ˆå¿«å°±å¿½ç•¥äº†ã€‚", 
                        "åœ¨å¼¯çš„è¾¹ç¼˜è¯•æ¢ï¼Œä½†åˆç¼©å›äº†è„šã€‚", 
                        "ä¸€åªè„šè¿˜åœ¨æŸœå¤–ï¼Œå¦ä¸€åªè„šåœ¨é—¨æ§›ä¸Šæ‘©æ“¦ã€‚",
                        "ä½ ä»¥ä¸ºä½ æ˜¯ç¬”ç›´çš„ï¼Œå…¶å®ä½ åªæ˜¯ä¸ªæœ‰ç‚¹å¼§åº¦çš„é¦™è•‰ã€‚",
                        "ä½ çš„æŸœé—¨å¼€äº†ä¸€æ¡ç¼ï¼Œä½†ä½ ä»¥ä¸ºé‚£æ˜¯é€šé£å£ã€‚",
                        "çœ‹åˆ°å¥½çœ‹çš„åŒæ€§ï¼Œä½ ä¼šå¿ƒæƒ³ï¼šâ€˜çš®è‚¤çœŸå¥½ï¼Œç”¨çš„ä»€ä¹ˆæŠ¤è‚¤å“ï¼Ÿâ€™",
                        "ä½ å·²ç»å¼€å§‹æ€è€ƒï¼Œä¸ºä»€ä¹ˆå½©è™¹æœ‰é‚£ä¹ˆå¤šé¢œè‰²ã€‚",
                        "ä½ çš„å–å‘å°±åƒè–›å®šè°”çš„çŒ«ï¼Œæ‰“å¼€æŸœå­å‰è°ä¹Ÿè¯´ä¸å‡†ã€‚"
                    ],
                    60: [ 
                        "æœ‰ç‚¹æ„æ€ï¼Œé›·è¾¾çš„æŒ‡é’ˆåŠ¨äº†ä¸€ä¸‹ã€‚", 
                        "å·²ç»å¼€å§‹å¯¹ä¸€äº›ç‰¹å®šç±»å‹çš„åŒæ€§äº§ç”Ÿæ¬£èµäº†ã€‚", 
                        "ä½ ç¦»å‡ºæŸœï¼Œå°±å·®ä¸€ä¸ªå¥‘æœºã€‚", 
                        "å˜´ä¸Šè¯´ç€ä¸è¦ï¼Œèº«ä½“å´å¾ˆè¯šå®ã€‚", 
                        "æ˜¯æ—¶å€™æ›´æ–°ä¸€ä¸‹ä½ çš„äº¤å‹è½¯ä»¶ç­›é€‰å™¨äº†ã€‚",
                        "ä½ çš„æµè§ˆå™¨å†å²è®°å½•ï¼Œå¯èƒ½æ¯”ä½ æ›´æ‡‚ä½ è‡ªå·±ã€‚",
                        "ä½ ä»¥ä¸ºä½ åœ¨å‡è§†æ·±æ¸Šï¼Œå…¶å®æ·±æ¸Šä¹Ÿåœ¨ç»™ä½ æŠ›åªšçœ¼ã€‚",
                        "ä½ ä¸æ˜¯å¼¯ï¼Œä½ åªæ˜¯åœ¨è¿›è¡Œä¸€ä¸ªä¼˜é›…çš„æ¼‚ç§»ã€‚",
                        "æœ‹å‹å·²ç»å¼€å§‹äº’ç›¸æ‰“èµŒä½ ä»€ä¹ˆæ—¶å€™ä¼šå®˜å®£äº†ã€‚",
                        "ä½ çš„æŸœå­å·²ç»ä¸æ˜¯æŸœå­äº†ï¼Œå®ƒæ˜¯ä¸ªç»ç’ƒå±•ç¤ºæŸœã€‚"
                    ],
                    75: [ 
                        "åˆ«è£…äº†ï¼Œä½ çš„å“å‘³å‡ºå–äº†ä½ ï¼", 
                        "Gayè¾¾å·²ç»å¼€å§‹æŠ¥è­¦ï¼Œåªæ˜¯å£°éŸ³æ¯”è¾ƒå°ã€‚", 
                        "ä½ æ€•ä¸æ˜¯é€šè®¯å½•é‡Œçš„å¸¸é©»å˜‰å®¾ï¼Ÿ", 
                        "è¯´å§ï¼Œä½ çš„ç†æƒ³å‹æ˜¯ä½“è‚²ç”Ÿè¿˜æ˜¯è‰ºæœ¯ç”Ÿï¼Ÿ", 
                        "çœ‹åˆ°å¸…å“¥/ç¾å¥³ä¼šå¿ƒè·³åŠ é€Ÿï¼Œä¸åˆ†æ€§åˆ«ã€‚",
                        "ä½ çš„æ­Œå•åˆ—è¡¨æš´éœ²äº†ä¸€åˆ‡ï¼Œåˆ«è§£é‡Šäº†ã€‚",
                        "ä½ ä¸æ˜¯åœ¨æ‰¾å¯¹è±¡ï¼Œä½ æ˜¯åœ¨ä¸ºé€šè®¯å½•çº³æ–°ã€‚",
                        "ä½ é€‰çš„è¡¨æƒ…åŒ…éƒ½æ¯”åˆ«äººå¼¯ä¸€ç‚¹ã€‚",
                        "åˆ«æŒ£æ‰äº†ï¼Œä½ çš„ç£åœºå·²ç»å¼€å§‹å¸å¼•åŒæäº†ã€‚",
                        "ä½ ç¦»æ‰“å¼€æ–°ä¸–ç•Œçš„å¤§é—¨ï¼Œåªå·®ä¸€æŠŠé’¥åŒ™ï¼Œè€Œé’¥åŒ™å°±åœ¨ä½ æ‰‹é‡Œã€‚"
                    ],
                    90: [ 
                        "è¡£æŸœé—¨éƒ½å¿«å…³ä¸ä½äº†å§ï¼", 
                        "å§¬è¾¾/Gayè¾¾ä¿¡å·å¼ºåº¦å·²çˆ†è¡¨ï¼", 
                        "ä¸‹ä¸€æ­¥æ˜¯ä¸æ˜¯å°±è¦ç»Ÿæ²»é€šè®¯å½•äº†ï¼Ÿ", 
                        "ä½ å¼¯å¾—åƒç›˜èšŠé¦™ï¼Œè¿˜å¸¦ç”µçš„é‚£ç§ã€‚", 
                        "åˆ«ç‚¹äº†ï¼Œè‡ªå·±äººï¼Œå¿«å¼€é—¨ï¼",
                        "ä½ ä¸æ˜¯å¼¯ï¼Œä½ æ˜¯åœ†è§„æˆç²¾ï¼Œè‡ªå¸¦åœ†å¿ƒã€‚",
                        "ä½ çš„æŸœå­å·²ç»ä¸æ˜¯æŸœå­ï¼Œæ˜¯ä»»æ„é—¨ï¼Œé€šå¾€æ–°ä¸–ç•Œã€‚",
                        "ä½ èµ°è¿‡çš„è·¯ï¼Œèƒ½è®©æ„å¤§åˆ©é¢éƒ½è‡ªæ„§ä¸å¦‚ã€‚",
                        "ä½ å·²ç»è¿›åŒ–äº†ï¼Œå–å‘è¿›åŒ–æˆäº†â€˜å¥½çœ‹çš„â€™ã€‚",
                        "åˆ«è—äº†ï¼Œä½ èº«ä¸Šçš„å½©è™¹å…‰èŠ’æ¯”WiFiä¿¡å·è¿˜å¼ºã€‚"
                    ],
                    100: [ 
                        "è­¦æŠ¥ï¼å·²æ— éœ€é‰´å®šï¼Œå¤©ç”Ÿçš„å¼¯ï¼", 
                        "ä½ å°±æ˜¯å½©è™¹æœ¬è™¹ï¼", 
                        "æ­å–œï¼ä½ å·²è§£é”â€˜é€šè®¯å½•å¤©èŠ±æ¿â€™æˆå°±ï¼", 
                        "å¼¯å¾—å½»åº•ï¼Œè¿å½±å­éƒ½æ˜¯å¼¯çš„ã€‚", 
                        "å‡ºå‚è®¾ç½®å°±æ˜¯å¼¯çš„ï¼Œåˆ«æŒ£æ‰äº†ã€‚",
                        "ä½ ä¸æ˜¯é€šè®¯å½•ï¼Œä½ æ˜¯é€šè®¯å½•çš„CEOï¼",
                        "é‡‘èµ›é‡è¡¨åœ¨ä½ é¢å‰éƒ½å¾—æ–°å¢ä¸€ä¸ªç»´åº¦ã€‚",
                        "ä½ ä¸€å¼ å˜´ï¼Œæ–¹åœ†åé‡Œçš„gayè¾¾éƒ½å¾—ç˜«ç—ªã€‚",
                        "åˆ«ç®—äº†ï¼Œå¿«å»æ¥¼ä¸‹å½©è™¹æ——é‚£å„¿æŠ¥åˆ°ï¼"
                    ]
                };
                let selectedTier;
                if (percentage === 0) selectedTier = messageTiers[0];
                else if (percentage <= 10) selectedTier = messageTiers[10];
                else if (percentage <= 20) selectedTier = messageTiers[20];
                else if (percentage <= 40) selectedTier = messageTiers[40];
                else if (percentage <= 60) selectedTier = messageTiers[60];
                else if (percentage <= 75) selectedTier = messageTiers[75];
                else if (percentage <= 90) selectedTier = messageTiers[90];
                else selectedTier = messageTiers[100];

                const messageIndex = Math.floor(Math.random() * selectedTier.length);

                return selectedTier[messageIndex];
            }
            
            function getProgressBarColor(percentage) {
                const colors = [ { p: 0, color: '#3b82f6' }, { p: 25, color: '#22c55e' }, { p: 50, color: '#eab308' }, { p: 75, color: '#f97316' }, { p: 100, color: '#d946ef' } ];
                for (let i = 1; i < colors.length; i++) {
                    if (percentage <= colors[i].p) {
                        const p1 = colors[i-1].p, p2 = colors[i].p, c1 = colors[i-1].color, c2 = colors[i].color;
                        const factor = (p2 - p1 === 0) ? 1 : (percentage - p1) / (p2 - p1);
                        const r1 = parseInt(c1.substring(1,3),16), g1 = parseInt(c1.substring(3,5),16), b1 = parseInt(c1.substring(5,7),16);
                        const r2 = parseInt(c2.substring(1,3),16), g2 = parseInt(c2.substring(3,5),16), b2 = parseInt(c2.substring(5,7),16);
                        const r = Math.round(r1 + factor * (r2-r1)), g = Math.round(g1 + factor * (g2-g1)), b = Math.round(b1 + factor * (b2-b1));
                        return `rgb(${r},${g},${b})`;
                    }
                }
                return colors[colors.length - 1].color;
            }

            function typeResultMessage(message) {
                clearInterval(typingInterval);
                resultMessage.textContent = '';
                let i = 0;
                typingInterval = setInterval(() => {
                    if (i < message.length) {
                        resultMessage.textContent += message.charAt(i);
                        i++;
                    } else {
                        clearInterval(typingInterval);
                    }
                }, 50); // æ¯ä¸ªå­— 50 æ¯«ç§’
            }

            function displayResult(name, percentage, message = null) { 
                resultName.textContent = name;
                resultSection.classList.remove('hidden');
                shareButton.classList.remove('hidden'); // æ˜¾ç¤ºåˆ†äº«æŒ‰é’®
                
                // é‡ç½®æ ·å¼
                percentageText.style.opacity = 0;
                resultMessage.textContent = '';
                percentageText.classList.remove('pop-in', 'rainbow-100');
                progressBar.classList.remove('pulsing-glow');
                
                setTimeout(() => progressBar.classList.add('pulsing-glow'), 100);

                let currentPercent = -1;
                const interval = setInterval(() => {
                    currentPercent++;
                    if (currentPercent >= percentage) {
                        clearInterval(interval);
                        currentPercent = percentage;
                        
                        percentageText.textContent = `${currentPercent}%`;
                        percentageText.style.opacity = 1;
                        percentageText.classList.add('pop-in'); // åº”ç”¨å¼¹å‡ºåŠ¨ç”»
                        
                        // å¦‚æœ message ä¸º nullï¼Œåˆ™å®æ—¶ç”Ÿæˆ
                        const finalMessage = message || getResultMessage(percentage, name); // ä¼ å…¥ name
                        typeResultMessage(finalMessage); // è°ƒç”¨æ‰“å­—æœºæ•ˆæœ

                        if (currentPercent === 100) {
                            percentageText.classList.add('rainbow-100');
                        }
                        
                        setTimeout(() => progressBar.classList.remove('pulsing-glow'), 500);

                        // ä¿å­˜å†å²è®°å½•
                        saveHistory(name, percentage, finalMessage);
                    }
                    progressBar.style.width = `${currentPercent}%`;
                    progressBar.style.backgroundColor = getProgressBarColor(currentPercent);
                    if(currentPercent !== -1) {
                       percentageText.textContent = `${currentPercent}%`;
                       percentageText.style.opacity = 1;
                    }
                }, 20);
            }

            async function handleShare() {
                const name = resultName.textContent;
                // const percentage = parseInt(percentageText.textContent); // ä¸å†éœ€è¦
                // const message = resultMessage.textContent; // ä¸å†éœ€è¦

                if (!name) { // åªæ£€æŸ¥åå­—
                    alert('è¯·å…ˆè®¡ç®—ä¸€ä¸ªç»“æœå†åˆ†äº«ï¼');
                    return;
                }

                const dataToEncode = `name=${encodeURIComponent(name)}`; // åªç¼–ç åå­—
                const encodedData = encodeBase64(dataToEncode);
                const shareUrl = `${window.location.origin}${window.location.pathname}?data=${encodedData}`;

                try {
                    await navigator.clipboard.writeText(shareUrl);
                    alert('åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š' + shareUrl);
                } catch (error) {
                    alert('å¤åˆ¶é“¾æ¥å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚');
                    console.error('Copy to clipboard failed:', error);
                }
            }

            function handleCalculation() {
                const originalName = nameInput.value;
                const trimmedName = originalName.trim(); // å»é™¤åå­—å‰åçš„ç©ºæ ¼
                if (!trimmedName) { // ä½¿ç”¨å»é™¤ç©ºæ ¼åçš„åå­—è¿›è¡Œæ£€æŸ¥
                    nameInput.classList.add('shake');
                    setTimeout(() => nameInput.classList.remove('shake'), 500);
                    return;
                }
                btnText.classList.add('hidden');
                btnSpinner.classList.remove('hidden');
                calculateBtn.disabled = true;
                resultSection.classList.add('hidden');
                shareButton.classList.add('hidden'); // éšè—åˆ†äº«æŒ‰é’®
                
                clearInterval(typingInterval); // å¦‚æœä¸Šæ¬¡çš„æ‰“å­—æœºè¿˜åœ¨è¿è¡Œï¼Œåˆ™æ¸…é™¤

                setTimeout(() => {
                    const normalizedParts = normalizeName(trimmedName); // ä½¿ç”¨å»é™¤ç©ºæ ¼åçš„åå­—è¿›è¡Œè®¡ç®—
                    const numericValues = getNumericValues(normalizedParts);
                    const finalPercentage = matrixCalculation(numericValues, trimmedName); // ä½¿ç”¨å»é™¤ç©ºæ ¼åçš„åå­—è¿›è¡Œè®¡ç®—
                    // displayResult ç°åœ¨ä¼šæ ¹æ® name å’Œ percentage å®æ—¶ç”Ÿæˆ message
                    displayResult(trimmedName, finalPercentage); // ä¼ é€’å»é™¤ç©ºæ ¼åçš„åå­—
                    btnText.classList.remove('hidden');
                    btnSpinner.classList.add('hidden');
                    calculateBtn.disabled = false;
                }, 800);
            }

            // æ£€æŸ¥URLå‚æ•°å¹¶æ˜¾ç¤ºç»“æœ
            function checkUrlParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const encodedData = urlParams.get('data');
                if (encodedData) {
                    const decodedData = decodeBase64(encodedData);
                    if (decodedData) {
                        const params = new URLSearchParams(decodedData);
                        const name = params.get('name');
                        // const percentage = parseInt(params.get('percentage')); // ä¸å†éœ€è¦
                        // const message = params.get('message'); // ä¸å†éœ€è¦

                        if (name) { // åªæ£€æŸ¥åå­—
                            nameInput.value = name; // å¡«å……è¾“å…¥æ¡†
                            handleCalculation(); // è§¦å‘è®¡ç®—æµç¨‹
                        }
                    }
                }
            }

            calculateBtn.addEventListener('click', handleCalculation);
            nameInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    handleCalculation();
                }
            });

            shareButton.addEventListener('click', handleShare); // åˆ†äº«æŒ‰é’®äº‹ä»¶ç›‘å¬

            historyToggleBtn.addEventListener('click', () => { // å†å²è®°å½•æŠ˜å æŒ‰é’®äº‹ä»¶ç›‘å¬
                historyPanel.classList.toggle('hidden');
            });

            historyList.addEventListener('click', (event) => { // å†å²è®°å½•åˆ—è¡¨ç‚¹å‡»äº‹ä»¶å§”æ‰˜
                if (event.target.classList.contains('recall-history')) {
                    const index = event.target.dataset.index;
                    recallHistoryItem(index);
                }
            });

            clearHistoryBtn.addEventListener('click', () => { // æ¸…é™¤å†å²è®°å½•æŒ‰é’®äº‹ä»¶ç›‘å¬
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
                    localStorage.removeItem('gayIndexHistory');
                    renderHistory(); // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
                }
            });

            // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
            renderHistory(); // æ¸²æŸ“å†å²è®°å½•
            checkUrlParams(); // æ£€æŸ¥URLå‚æ•°
        };
    </script>
</body>
</html>
